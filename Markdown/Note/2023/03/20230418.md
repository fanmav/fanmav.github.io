# Next.js 13 ts 页面跳转动画

在 Next.js 13 中，你可以使用 `next/router` 提供的 `useRouter` hook 来监听路由变化，然后结合 CSS 动画实现页面跳转动画。

以下是一个简单的例子：

```tsx
import { useRouter } from 'next/router';
import { useEffect, useState } from 'react';
import styles from './PageTransition.module.css';

const PageTransition: React.FC = ({ children }) => {
  const router = useRouter();
  const [isAnimating, setIsAnimating] = useState(false);

  useEffect(() => {
    const handleStart = () => setIsAnimating(true);
    const handleComplete = () => setIsAnimating(false);

    router.events.on('routeChangeStart', handleStart);
    router.events.on('routeChangeComplete', handleComplete);
    router.events.on('routeChangeError', handleComplete);

    return () => {
      router.events.off('routeChangeStart', handleStart);
      router.events.off('routeChangeComplete', handleComplete);
      router.events.off('routeChangeError', handleComplete);
    };
  }, [router]);

  return (
    <div className={isAnimating ? styles.animating : ''}>
      {children}
    </div>
  );
};

export default PageTransition;
```

在这个组件中，我们使用 `useRouter` hook 监听路由变化，当路由变化时，我们会将 `isAnimating` 置为 `true`，然后通过 CSS 动画实现页面跳转效果。在动画结束后，我们将 `isAnimating` 置为 `false`。

你需要自己通过 CSS 实现跳转动画，例如：

```css
.animating {
  opacity: 0;
  transition: opacity 0.5s ease-in-out;
}
```

在你的页面组件中，你可以使用 `PageTransition` 组件包裹你的内容，例如：

```tsx
import PageTransition from '@/components/PageTransition';

const MyPage: React.FC = () => {
  return (
    <PageTransition>
      <div>My Page</div>
    </PageTransition>
  );
};

export default MyPage;
```


要在 Next.js 13 中实现页面跳转动画，可以使用两种方法：

1. 使用自定义 App 组件

在 pages 目录下创建一个名为 _app.tsx 的文件，并在其中定义一个自定义 App 组件。在该组件中，可以使用 Next.js 提供的 useRouter 和 useEffect 钩子来监听路由变化，并使用 CSS 动画实现页面跳转动画。例如：

```typescript
import { AppProps } from "next/app";
import { useRouter } from "next/router";
import { useEffect, useState } from "react";
import "../styles/globals.css";

function MyApp({ Component, pageProps }: AppProps) {
  const router = useRouter();
  const [isAnimating, setIsAnimating] = useState(false);

  useEffect(() => {
    const handleRouteChangeStart = () => {
      setIsAnimating(true);
    };

    const handleRouteChangeComplete = () => {
      setIsAnimating(false);
    };

    router.events.on("routeChangeStart", handleRouteChangeStart);
    router.events.on("routeChangeComplete", handleRouteChangeComplete);

    return () => {
      router.events.off("routeChangeStart", handleRouteChangeStart);
      router.events.off("routeChangeComplete", handleRouteChangeComplete);
    };
  }, [router]);

  return (
    <div className={`page-wrapper ${isAnimating ? "animating" : ""}`}>
      <Component {...pageProps} />
    </div>
  );
}

export default MyApp;
```

在上面的代码中，我们定义了一个名为 `isAnimating` 的状态来表示页面是否正在进行动画。在 useEffect 钩子中，我们使用 `router.events` 监听路由变化事件，当路由开始变化时，将 `isAnimating` 设置为 `true`，当路由变化完成时，将其设置为 `false`。在组件返回的 JSX 中，我们使用 `isAnimating` 来控制页面的 CSS 类名，从而触发动画效果。

2. 使用 Framer Motion 库

Framer Motion 是一个流行的动画库，可以帮助我们实现复杂的动画效果。在 Next.js 13 中，可以直接在页面组件中使用 Framer Motion 来实现页面跳转动画。例如：

```typescript
import { motion } from "framer-motion";
import { useRouter } from "next/router";
import "../styles/globals.css";

function MyApp({ Component, pageProps }) {
  const router = useRouter();

  return (
    <motion.div
      key={router.route}
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
    >
      <Component {...pageProps} />
    </motion.div>
  );
}

export default MyApp;
```

在上面的代码中，我们使用了 Framer Motion 提供的 `motion.div` 组件来包裹页面组件。在该组件中，我们使用 `initial` 属性来定义页面初始状态，`animate` 属性来定义页面动画结束状态，`exit` 属性来定义页面退出动画状态。当页面发生跳转时，Framer Motion 会自动根据这些状态来实现动画效果。需要注意的是，页面组件的 `key` 值必须与路由路径相同，这样 Framer Motion 才能正确地应用动画效果。



# Next.js 13 ts 页面跳转进度条

在 Next.js 13 中，可以使用内置的 `next/router` 模块和 `nprogress` 库来实现页面跳转时显示进度条的效果。

首先安装 `nprogress` 库：

```bash
npm install nprogress
```

然后在 `_app.tsx` 中引入样式和设置进度条：

```tsx
import 'nprogress/nprogress.css';
import Router from 'next/router';
import nprogress from 'nprogress';

// 路由事件监听
Router.events.on('routeChangeStart', () => {
  nprogress.start(); // 进度条开始
});
Router.events.on('routeChangeComplete', () => {
  nprogress.done(); // 进度条结束
});
Router.events.on('routeChangeError', () => {
  nprogress.done(); // 进度条结束
});

function MyApp({ Component, pageProps }: AppProps) {
  return <Component {...pageProps} />;
}

export default MyApp;
```

此时页面跳转时会显示进度条。如果需要自定义进度条样式，可以在 `_app.tsx` 中设置 `nprogress.configure()`：

```tsx
nprogress.configure({
  minimum: 0.1,
  easing: 'ease',
  speed: 800,
  showSpinner: false,
  barStyle: {
    backgroundColor: '#1890ff',
    height: '2px',
    position: 'fixed',
    top: 0,
    left: 0,
    zIndex: 9999,
  },
});
```

# Next.js 13 ts 页面跳转进度条 不安装 nprogress 如何实现

你可以通过添加一个简单的CSS动画效果作为跳转进度条的替代方案，以下是一个示例：

首先，在你的公共CSS文件中，创建一个表示进度条状态的样式类。例如，下面的CSS规则将为loader类创建一个缩放动画效果：

```css
.loader {
  position: fixed;
  top: 0;
  width: 100%;
  height: 4px;
  background-color: #76b6c1;
  z-index: 9999;
  -webkit-animation: loader 0.5s ease-out forwards;
  animation: loader 0.5s ease-out forwards;
}

@-webkit-keyframes loader {
  from {
    transform: scaleX(0);
  }
  to {
    transform: scaleX(1);
  }
}

@keyframes loader {
  from {
    transform: scaleX(0);
  }
  to {
    transform: scaleX(1);
  }
}
```

当页面开始加载时，动态向DOM插入该样式类：

```js
import { useRouter } from "next/router";
import { useEffect, useState } from "react";

export default function MyPage() {
  const router = useRouter();
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    const handleRouteChangeStart = () => setLoading(true);
    const handleRouteChangeComplete = () => setLoading(false);

    router.events.on("routeChangeStart", handleRouteChangeStart);
    router.events.on("routeChangeComplete", handleRouteChangeComplete);
    router.events.on("routeChangeError", handleRouteChangeComplete);

    return () => {
      router.events.off("routeChangeStart", handleRouteChangeStart);
      router.events.off("routeChangeComplete", handleRouteChangeComplete);
      router.events.off("routeChangeError", handleRouteChangeComplete);
    };
  }, [router]);

  return (
    <>
      {loading && <div className="loader" />}
      {/* Your page content goes here */}
    </>
  );
}
```
在这个示例中，我们使用useState钩子来控制进度条的可见性，当路由开始变化时，我们将其设置为true，在路由变完成时我们将其设置为false。


```js
  Router.events.on("beforePopState", ({ url, asPath }) => {
    const currentPath = window.location.pathname;
    const nextPath = asPath;

    // 在这里处理页面跳转动画
    const page = document.querySelector(".page");
    page.classList.add("page-transition");

    // 等待动画结束后再切换页面
    setTimeout(() => {
      Router.push(url, asPath);
    }, 500);

    // 阻止默认行为
    window.history.pushState({}, "", currentPath);
    return false;
  });
```

# Next.js 13 ts 页面跳转动画 等待动画结束后再切换页面

# 这段代码如何设置 animating 出现 1秒持续时间

# Next.js 13 ts 页面跳转动画 ，点击链接后 先执行动画，动画执行完后开始跳转页面

```tsx
import '@/styles/globals.css'
import '@/styles/FanMa.css'
import 'prismjs/themes/prism-okaidia.css'
import 'prismjs/plugins/line-numbers/prism-line-numbers.css'
import '@/styles/prism-overrides.css'
import type { AppProps } from 'next/app'
import { useRouter } from 'next/router'
import { useEffect, useState } from 'react'

export default function App({ Component, pageProps }: AppProps) {


  const router = useRouter();
  const [isAnimating, setIsAnimating] = useState(false);

  useEffect(() => {
    const handleRouteChangeStart = () => {
      setIsAnimating(true);
      setTimeout(() => {
        setIsAnimating(false);
      }, 1000);
    };
    
    const handleRouteChangeComplete = () => {
      setIsAnimating(false);
    };

    router.events.on('routeChangeStart', handleRouteChangeStart);
    router.events.on('routeChangeComplete', handleRouteChangeComplete);

    return () => {
      router.events.off('routeChangeStart', handleRouteChangeStart);
      router.events.off('routeChangeComplete', handleRouteChangeComplete);
    };
  }, [Component, pageProps]);
    
  return (

      <div className={`page ${isAnimating ? 'animating' : ''} 8`}>
        <Component {...pageProps} />
      </div>

  );
}
```