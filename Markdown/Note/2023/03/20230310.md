

您可以使用Node.js的内置模块fs来读取子文件夹中的.md文件。以下是一个示例代码片段，它使用fs模块的readdirSync方法来读取指定目录中的所有文件和子目录，然后使用递归函数来遍历所有子目录并读取其中的.md文件。

```js
const fs = require('fs');
const path = require('path');

function readMarkdownFiles(dir) {
  const files = fs.readdirSync(dir);
  const markdownFiles = [];

  files.forEach(file => {
    const filePath = path.join(dir, file);
    const stat = fs.statSync(filePath);

    if (stat.isDirectory()) {
      markdownFiles.push(...readMarkdownFiles(filePath));
    } else if (path.extname(filePath) === '.md') {
      const content = fs.readFileSync(filePath, 'utf-8');
      markdownFiles.push({ path: filePath, content });
    }
  });

  return markdownFiles;
}

const markdownFiles = readMarkdownFiles('./my-folder');
console.log(markdownFiles);
```

在上面的代码中，readMarkdownFiles函数接受一个目录路径作为参数，并返回一个包含所有.md文件路径和内容的数组。该函数首先使用fs.readdirSync方法读取指定目录中的所有文件和子目录，然后使用fs.statSync方法检查每个文件是否是目录。如果是目录，则递归调用readMarkdownFiles函数来读取其中的.md文件。如果是.md文件，则使用fs.readFileSync方法读取文件内容，并将路径和内容添加到markdownFiles数组中。最后，该函数返回markdownFiles数组。

请注意，上面的代码示例使用同步方法来读取文件和目录。如果您需要异步读取文件和目录，请使用相应的异步方法。


## TS

可以使用 fs 模块读取文件系统中的 .md 文件。在 Next.js 中，可以在 getStaticProps 函数中使用 fs 模块读取文件。由于 Next.js 将代码编译到单独的目录中，因此需要使用 process.cwd() 获取文件的完整路径。

以下是一个示例，演示如何读取子文件夹中的 .md 文件：

```ts
import fs from 'fs'
import path from 'path'
import matter from 'gray-matter'
import marked from 'marked'

export default function Blog({ posts }) {
  return (
    <div>
      <h1>Blog</h1>
      <ul>
        {posts.map((post) => (
          <li key={post.slug}>
            <h2>{post.frontmatter.title}</h2>
            <div dangerouslySetInnerHTML={{ __html: post.html }} />
          </li>
        ))}
      </ul>
    </div>
  )
}

export async function getStaticProps() {
  const postsDirectory = path.join(process.cwd(), 'posts')
  const filenames = fs.readdirSync(postsDirectory)

  const posts = filenames.map((filename) => {
    const filePath = path.join(postsDirectory, filename)
    const fileContents = fs.readFileSync(filePath, 'utf8')
    const { data, content } = matter(fileContents)

    const html = marked(content)

    return {
      frontmatter: data,
      slug: filename.replace('.md', ''),
      content,
      html,
    }
  })

  return {
    props: {
      posts,
    },
  }
}
```

在上面的示例中，getStaticProps 函数使用 fs 模块读取 posts 文件夹中的所有 .md 文件。然后，使用 gray-matter 模块解析 .md 文件的元数据和内容。最后，使用 marked 模块将 .md 文件的内容转换为 HTML。

请注意，上面的示例使用了同步的 fs 方法。在实际应用中，可能需要使用异步的 fs 方法，以避免阻塞事件循环。


## TS

你可以使用 Node.js 的 fs 模块和 path 模块来读取所有子文件夹里的 .md 文件。以下是一个示例代码，它使用递归函数来遍历所有子文件夹并读取 .md 文件：

```ts
import fs from 'fs'
import path from 'path'
import matter from 'gray-matter'
import marked from 'marked'

interface Post {
  slug: string
  title: string
  date: string
  content: string
}

export default function Blog({ posts }: { posts: Post[] }) {
  return (
    <ul>
      {posts.map((post) => (
        <li key={post.slug}>
          <h3>{post.title}</h3>
          <p>{post.date}</p>
          <div dangerouslySetInnerHTML={{ __html: post.content }} />
        </li>
      ))}
    </ul>
  )
}

export async function getStaticProps() {
  const postsDirectory = path.join(process.cwd(), 'posts')
  const posts = await getAllPosts(postsDirectory)

  return {
    props: {
      posts,
    },
  }
}

async function getAllPosts(directory: string): Promise<Post[]> {
  const files = fs.readdirSync(directory)

  const posts = files.map((filename) => {
    const filePath = path.join(directory, filename)
    const fileContents = fs.readFileSync(filePath, 'utf8')
    const { data, content } = matter(fileContents)

    const slug = filename.replace(/\.md$/, '')
    const title = data.title
    const date = data.date.toDateString()
    const html = marked(content)

    return {
      slug,
      title,
      date,
      content: html,
    }
  })

  const subdirectories = files.filter((filename) =>
    fs.statSync(path.join(directory, filename)).isDirectory()
  )

  for (const subdirectory of subdirectories) {
    const subdirectoryPath = path.join(directory, subdirectory)
    const subdirectoryPosts = await getAllPosts(subdirectoryPath)
    posts.push(...subdirectoryPosts)
  }

  return posts
}
```

在这个示例中，getAllPosts 函数接收一个目录路径作为参数，并返回一个包含所有 .md 文件内容的 Post 数组。它首先读取目录中的所有文件，并使用 matter 模块解析 .md 文件的元数据和内容。然后，它将元数据和内容转换为 Post 对象，并使用 marked 模块将 .md 文件的内容转换为 HTML。最后，它递归遍历所有子文件夹，并将它们的 Post 对象添加到结果数组中。

在 getStaticProps 函数中，它使用 getAllPosts 函数来获取所有 .md 文件的内容，并将它们作为 props 对象的属性返回。然后，Blog 组件使用这些 props 来渲染所有博客文章的标题、日期和内容。


## ts

可以使用 fs 模块和 path 模块来读取 blog 文件夹里所有子文件夹里的 .md 文件。可以使用 readdir 方法读取文件夹中的所有文件名，然后使用 stat 方法判断文件是否是文件夹，如果是文件夹，则递归调用自身，如果是 .md 文件，则读取文件内容并将其存储在数组中。

```ts
import fs from 'fs'
import path from 'path'

export async function getStaticProps() {
  const postsDirectory = path.join(process.cwd(), 'blog')
  const filenames = await fs.promises.readdir(postsDirectory)

  const posts = await Promise.all(
    filenames.map(async (filename) => {
      const filePath = path.join(postsDirectory, filename)
      const fileStat = await fs.promises.stat(filePath)

      if (fileStat.isDirectory()) {
        // Recursively call getStaticProps to get posts from subdirectories
        return getStaticProps({ params: { slug: [filename] } })
      } else if (filename.endsWith('.md')) {
        const fileContents = await fs.promises.readFile(filePath, 'utf8')
        // Parse fileContents to extract metadata and content
        return {
          filename,
          content: fileContents,
        }
      }
    })
  )

  return {
    props: {
      posts: posts.flat(),
    },
  }
}
```

这个例子中，我们使用 fs.promises 来读取文件和文件夹，使用 path.join 来构建文件路径。我们使用 Promise.all 来并行读取所有文件，然后使用 flat 方法将所有子数组合并成一个数组。在读取 .md 文件时，我们可以使用 gray-matter 等库来解析文件内容，提取元数据和内容。

## .tsx 读取 blog 文件夹里所有子文件夹里的 .md 文件

Here's an example of how to read all .md files in subdirectories of the blog folder using TypeScript and Next.js:

```ts
import { GetStaticProps, InferGetStaticPropsType } from 'next'
import fs from 'fs'
import path from 'path'
import matter from 'gray-matter'

type Post = {
  slug: string
  title: string
  content: string
}

type Props = {
  posts: Post[]
}

export const getStaticProps: GetStaticProps<Props> = async () => {
  const postsDirectory = path.join(process.cwd(), 'blog')
  const posts = await getAllPosts(postsDirectory)

  return {
    props: {
      posts,
    },
  }
}

async function getAllPosts(directory: string): Promise<Post[]> {
  const files = await fs.promises.readdir(directory)

  const posts: Post[] = []

  for (const file of files) {
    const filePath = path.join(directory, file)
    const stat = await fs.promises.stat(filePath)

    if (stat.isDirectory()) {
      const nestedPosts = await getAllPosts(filePath)
      posts.push(...nestedPosts)
    } else if (file.endsWith('.md')) {
      const fileContents = await fs.promises.readFile(filePath, 'utf8')
      const { data, content } = matter(fileContents)

      posts.push({
        slug: file.replace(/\.md$/, ''),
        title: data.title,
        content,
      })
    }
  }

  return posts
}

export default function Blog({
  posts,
}: InferGetStaticPropsType<typeof getStaticProps>) {
  return (
    <ul>
      {posts.map((post) => (
        <li key={post.slug}>
          <h3>{post.title}</h3>
          <p>{post.content}</p>
        </li>
      ))}
    </ul>
  )
}
```

This code defines a Post type and a Props type that are used to define the shape of the data returned by getStaticProps. The getAllPosts function recursively reads all files in the blog directory and its subdirectories, and returns an array of Post objects. The getStaticProps function calls getAllPosts and returns the resulting array of Post objects as a prop to the Blog component. Finally, the Blog component renders a list of all the posts.

## .tsx 读取 blog 文件夹里所有子文件夹里的 .md 文件 中文

在 Next.js 中，我们可以使用 getStaticProps 函数来在构建时获取数据。如果我们想要读取 blog 文件夹中所有子文件夹中的 .md 文件，我们可以使用以下代码：


```ts
import fs from 'fs'
import path from 'path'
import matter from 'gray-matter'

export async function getStaticProps() {
  const postsDirectory = path.join(process.cwd(), 'blog')
  const directories = fs.readdirSync(postsDirectory)

  const posts = directories.reduce((acc, dir) => {
    const dirPath = path.join(postsDirectory, dir)
    const filenames = fs.readdirSync(dirPath)

    const dirPosts = filenames.map((filename) => {
      const filePath = path.join(dirPath, filename)
      const fileContents = fs.readFileSync(filePath, 'utf8')
      const { data, content } = matter(fileContents)

      // 在这里可以对内容进行解析和转换

      return {
        filename,
        data,
        content,
      }
    })

    return [...acc, ...dirPosts]
  }, [])

  return {
    props: {
      posts,
    },
  }
}
```
这个函数会读取 blog 文件夹中的所有子文件夹，然后读取每个子文件夹中的 .md 文件。我们使用 gray-matter 库来解析 .md 文件的元数据和内容。在这个例子中，我们只是简单地将元数据和内容存储在一个对象中，但你可以在这里对内容进行解析和转换。最后，我们将所有的文章存储在一个数组中，并将其作为 props 返回。

##  lib/blog.tsx  读取 blog 文件夹里所有子文件夹里的 .md 文件 

```ts
import fs from 'fs'
import path from 'path'
import matter from 'gray-matter'

export type Post = {
  slug: string
  title: string
  date: string
  content: string
}

const postsDirectory = path.join(process.cwd(), 'blog')

export function getPosts(): Post[] {
  const allPosts = fs.readdirSync(postsDirectory, { withFileTypes: true })
  const posts = allPosts
    .filter((post) => post.isDirectory())
    .flatMap((post) => {
      const postDirectory = path.join(postsDirectory, post.name)
      const postFiles = fs.readdirSync(postDirectory)
      return postFiles
        .filter((file) => file.endsWith('.md'))
        .map((file) => {
          const slug = path.join(post.name, file.replace(/\.md$/, ''))
          const fullPath = path.join(postDirectory, file)
          const fileContents = fs.readFileSync(fullPath, 'utf8')
          const { data, content } = matter(fileContents)
          return {
            slug,
            title: data.title,
            date: data.date,
            content,
          }
        })
    })
  return posts
}
```

This code reads all .md files in all subdirectories of the blog directory and returns an array of Post objects. Each Post object has a slug, title, date, and content property. The slug is the relative path to the .md file, and the content is the markdown content of the file. The matter package is used to parse the front matter of the .md files.



```ts
import fs from 'fs'
import path from 'path'

export async function getStaticPaths() {
  const postsDirectory = path.join(process.cwd(), 'blog')
  const subdirectories = fs.readdirSync(postsDirectory, { withFileTypes: true })
    .filter(dirent => dirent.isDirectory())
    .map(dirent => dirent.name)

  const paths = subdirectories.flatMap(subdirectory => {
    const directoryPath = path.join(postsDirectory, subdirectory)
    const filenames = fs.readdirSync(directoryPath)
      .filter(filename => filename.endsWith('.md'))

    return filenames.map(filename => ({
      params: {
        slug: [subdirectory, filename.replace(/\.md$/, '')]
      }
    }))
  })

  return {
    paths,
    fallback: false
  }
}
```

[...slug].tsx 读取 article 文件夹里所有子文件夹里的 .md 文件 getStaticPaths 代码



