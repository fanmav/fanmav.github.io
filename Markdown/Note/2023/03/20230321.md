
# Nextjs 13 build 的时候生成 .html.html 的文件后缀

我的网站在 build 构建生成 HTML 静态文件时，它会多出来个 `.html` 的文件后缀。

首页文件名正常
```
https://fanmau.github.io/index.html
```
文章页生成的文件名就多了一个 `.html` 
```
https://fanmau.github.io/blog/2023/1.html.html
https://fanmau.github.io/blog/2023/2.html.html
```

## Demo

[https://fanmau.github.io](https://fanmau.github.io)

## Deploy Example

我的源码库： [GitHub Pages](https://github.com/fanmau/fanmau.github.io) 

网站静态文件： [https://github.com/fanmau/fanmau.github.io/tree/fanma](https://github.com/fanmau/fanmau.github.io/tree/fanma) 

## 网站结构

这是我想要的网址结构
```
https://fanmau.github.io
https://fanmau.github.io/blog/2023/1.html
https://fanmau.github.io/blog/2023/2.html
https://fanmau.github.io/blog/2023/3.html
https://fanmau.github.io/blog/2023/4.html
https://fanmau.github.io/blog/2023/5.html
```

但是生成的文件结构

```
https://fanmau.github.io
https://fanmau.github.io/blog/2023/1.html.html
https://fanmau.github.io/blog/2023/2.html.html
https://fanmau.github.io/blog/2023/3.html.html
https://fanmau.github.io/blog/2023/4.html.html
https://fanmau.github.io/blog/2023/5.html.html
```

实际上 `https://fanmau.github.io/blog/2023/1.html` 也可以正常访问。

## 依赖版信息

```
  "dependencies": {
    "@types/node": "18.14.4",
    "@types/react": "18.0.28",
    "@types/react-dom": "18.0.11",
    "@types/slug": "^5.0.3",
    "date-fns": "^2.29.3",
    "gray-matter": "^4.0.3",
    "highlight.js": "^11.7.0",
    "moment-timezone": "^0.5.41",
    "next": "13.2.3",
    "next-sitemap": "^4.0.5",
    "prismjs": "^1.29.0",
    "react": "18.2.0",
    "react-dom": "18.2.0",
    "remark": "^14.0.2",
    "remark-html": "^15.0.1",
    "remark-prism": "^1.3.6",
    "sitemap": "^7.1.1",
    "slug": "^8.2.2",
    "typescript": "4.9.5"
  },
  "devDependencies": {
    "@types/prismjs": "^1.26.0",
    "@types/remark-prism": "^1.3.4"
  }
```

## 我想这样做

我想在 params 里保留 `.html` 后缀，但构建文件的时候只生成 `1.html` ，而不是现在的 `1.html.html`。

```
export const getStaticPaths: GetStaticPaths = async () => {
  return {
    paths: [
      { params: { slug: ["path", "to", "page", "5.html"] } },
      { params: { slug: ["another", "path", "1.html"] } },
      { params: { slug: ["another", "path", "8.html"] } },
      { params: { slug: ["another", "path", "9.html"] } },
    ],
    fallback: false,
  };
};
```

请问我要如何去掉构建文件的时多出来的 `.html.html` 文件后缀呢。


感谢你的回答


我知道这里我加了一个 `concat('.html')` 进去，我就是想要这种效果。

我不想在这里把 concat('.html') 去掉,我想保留它现在这个样子。

我花了3天的时候，找了很多办法都没有更好的解决办法。

在今天的时候，我终于找到了一个相对来说比较好的解决方案。今天我测试了好几次，觉得这个方案还是很好的。

使用 Node.js 的文件系统模块"fs"和路径模块"path"中提供的fs.readdir(), path.join(), fs.rename()方法来将所有后缀名为".html.html"的文件重命名为后缀名为".html"的文件。具体实现方法可参考以下示例代码：

```js
const fs = require('fs');
const path = require('path');

function renameFiles(dir) {
  fs.readdir(dir, (err, files) => {               // 读取目录下所有文件和子目录
    if (err) throw err;
    files.forEach(file => {                       // 遍历文件和子目录
      const filePath = path.join(dir, file);      // 获取完整路径
      fs.stat(filePath, (err, stat) => {          // 判断是否是文件
        if (err) throw err;
        if (stat.isFile() && file.endsWith('.html.html')) {  // 判断文件名是否是 ".html.html"
          const newFilePath = path.join(dir, file.replace('.html.html', '.html'));
          fs.rename(filePath, newFilePath, (err) => {    // 重命名文件
            if (err) throw err;
            console.log(`${filePath} renamed to ${newFilePath}`);
          });
        } else if (stat.isDirectory()) {              // 如果是子目录则递归处理
          renameFiles(filePath);
        }
      });
    });
  });
}

renameFiles('path/to/directory');  // 替换为需要操作的目录路径
```

使用这个方法的效果示例如下：

```ssh
out\blog\2023\1.html.html renamed to out\blog\2023\1.html
out\blog\2023\2.html.html renamed to out\blog\2023\2.html
out\blog\2023\3.html.html renamed to out\blog\2023\3.html
out\blog\2023\4.html.html renamed to out\blog\2023\4.html
out\blog\2023\5.html.html renamed to out\blog\2023\5.html
out\blog\2023\6.html.html renamed to out\blog\2023\6.html
out\blog\2023\7.html.html renamed to out\blog\2023\7.html
out\blog\2023\8.html.html renamed to out\blog\2023\8.html
out\blog\2023\9.html.html renamed to out\blog\2023\9.html
```

这就是我现在的解决方案，它还是很好用的。

现在，所有重复 .html.html 文件扩展名的文件，就全部重命名为 .html 了。