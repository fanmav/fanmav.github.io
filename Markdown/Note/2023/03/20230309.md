
静态生成网站地图 完整代码


Next.js 怎么修改 TSX <html lang="en"> 标签

TSX 静态生成网站地图 sitemap.xml  完整代码

sitemap.xml.tsx to SSG

Static

sitemap.xml.tsx generate sitemap.xml SSG 具体配置

next.config.js

 sitemap.xml.tsx to sitemap.xml next.config.js

sitemap.xml.tsx generate a sitemap.xml 

To generate a static sitemap for your Next.js application, you can use the sitemap package. Here's an example of how to use it:

First, install the sitemap package:

```ssh
npm install --save sitemap
```

Next, create a sitemap.xml.js file in the root of your project:

```js
import { createSitemap } from 'sitemap';
import { getStaticPaths } from './your-data-fetching-module';

async function generateSitemap() {
  const sitemap = createSitemap({
    hostname: 'https://example.com',
    cacheTime: 600000, // 600 sec - cache purge period
  });

  const paths = await getStaticPaths();

  paths.forEach((path) => {
    sitemap.add({
      url: `${path}`,
      changefreq: 'daily',
      priority: 0.7,
    });
  });

  return sitemap.toString();
}

export default generateSitemap;
```

In this example, we're using the createSitemap function from the sitemap package to create a new sitemap object. We're also using a getStaticPaths function from a separate module to get the list of static paths to include in the sitemap.

Finally, add a script to your package.json file to generate the sitemap:

```json
{
  "scripts": {
    "generate-sitemap": "node -e 'require(\"./sitemap.xml.js\").default().then(console.log)' > public/sitemap.xml"
  }
}
```


This script will run the generateSitemap function and output the result to a sitemap.xml file in the public directory.

You can then run the script with:

```ssh
npm run generate-sitemap
```

And your sitemap will be generated!


以下是使用 TypeScript 和 Next.js 的静态生成网站地图的完整代码示例：


```ts
import { GetStaticProps } from 'next';
import { SitemapStream, streamToPromise } from 'sitemap';
import { createGzip } from 'zlib';
import { ServerResponse } from 'http';
import { NextSeo } from 'next-seo';

import { getAllPosts } from '../lib/posts';
import { Post } from '../types/post';

interface SitemapUrl {
  url: string;
  changefreq: 'always' | 'hourly' | 'daily' | 'weekly' | 'monthly' | 'yearly' | 'never';
  priority: number;
}

interface SitemapProps {
  posts: Post[];
}

const Sitemap = ({ posts }: SitemapProps): null => null;

export const getStaticProps: GetStaticProps = async ({ res }) => {
  if (!res) {
    return {
      notFound: true,
    };
  }

  const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000';
  const sitemapStream = new SitemapStream({
    hostname: baseUrl,
  });
  const pipeline = sitemapStream.pipe(createGzip());
  const response = res as ServerResponse;

  const urls: SitemapUrl[] = [
    {
      url: '/',
      changefreq: 'daily',
      priority: 1,
    },
    {
      url: '/about',
      changefreq: 'monthly',
      priority: 0.7,
    },
    {
      url: '/contact',
      changefreq: 'monthly',
      priority: 0.7,
    },
    ...posts.map((post) => ({
      url: `/posts/${post.slug}`,
      changefreq: 'weekly',
      priority: 0.9,
    })),
  ];

  urls.forEach((url) => {
    sitemapStream.write(url);
  });

  sitemapStream.end();

  response.setHeader('content-type', 'application/xml');
  response.setHeader('content-encoding', 'gzip');

  const sitemap = await streamToPromise(pipeline);

  response.write(sitemap);
  response.end();

  return {
    props: {},
  };
};

export default Sitemap;
```

这个示例中，我们使用 SitemapStream 和 streamToPromise 从我们的 Next.js 应用程序中生成一个 sitemap.xml 文件。我们还使用 createGzip 将 sitemap 压缩为 gzip 格式，以便更快地传输。我们还使用 getAllPosts 函数获取所有博客文章，并将它们添加到 sitemap 中。最后，我们将 sitemap 发送回客户端。