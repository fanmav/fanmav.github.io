import Link from 'next/link'

function Blog({ posts, page, total }) {
  const prevPage = page > 1 ? page - 1 : null
  const nextPage = page < total ? page + 1 : null

  return (
    <div>
      <ul>
        {posts.map((post) => (
          <li key={post.id}>
            <Link href={`/blog/${post.id}`}>
              <a>{post.title}</a>
            </Link>
          </li>
        ))}
      </ul>
      <div>
        {prevPage && (
          <Link href={`/blog?page=${prevPage}`}>
            <a>Previous</a>
          </Link>
        )}
        {nextPage && (
          <Link href={`/blog?page=${nextPage}`}>
            <a>Next</a>
          </Link>
        )}
      </div>
    </div>
  )
}

export async function getServerSideProps({ query }) {
  const page = parseInt(query.page || '1', 10)
  const res = await fetch(`https://jsonplaceholder.typicode.com/posts?_page=${page}`)
  const posts = await res.json()
  const total = parseInt(res.headers.get('X-Total-Count'))

  return {
    props: {
      posts,
      page,
      total: Math.ceil(total / 10),
    },
  }
}

